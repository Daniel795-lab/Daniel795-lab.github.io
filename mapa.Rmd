---
title: "Campaña COVID-19, Pastoral Juvenil P.Cristo de Emaús"
author: "by Daniel Ugalde (diugalde@uc.cl)"
date: "Fecha de actualización: **`r Sys.Date()`**"
output: html_document
---

[Ver en Google Maps](https://bit.ly/ayuda_familias)

```{r global options, echo = FALSE, force = TRUE, message = FALSE, warning = FALSE}
library(knitr)
library(tidyverse)
library(sf)
library(mapview)
library(readxl)
library(magrittr)
library(printr)
library(lubridate)
library(plotly)
setwd("C:/Users/Daniel/Desktop/CAMP_SOLID/Daniel795-lab.github.io")
```



```{r, echo=F, force = T, message= F, warning = F, collapse=TRUE}
myurl <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQawLKRruyLNHg1LSMjfxt0siwuj9ng_wxQlDM-a3aWUD1Z4LiVIP9E8lfrvAywQQUaluxVGFMlZhx5/pub?gid=1371277324&single=true&output=csv"
wti <- read_csv(url(myurl))
data_1 <- wti

data_1 %<>%
  mutate(lon_x = as.double(paste0(str_sub(LONGITUD, start = 1, end = 3), ".",
                                  str_sub(LONGITUD, start = 4))),
         lat_y = as.double(paste0(str_sub(LATITUD, start = 1, end = 3), ".",
                                  str_sub(LATITUD, start = 4))))

familias_apoyadas <- st_as_sf(data_1,
                      coords = c("lon_x", "lat_y"),
                      crs = 4326)

```

```{r, echo=FALSE, include=FALSE, message= F, warning = F}
familias_ayudadas <- familias_apoyadas %>% 
  select(ID, COMUNA, INTEGRANTES_GRUPO_FAMILIAR, NACIONALIDAD, AYUDA_ENTREGADA, 
         FECHA_AYUDA, AYUDA_ENTREGADA2, FECHA_AYUDA2)
```

```{r echo=FALSE, collapse=TRUE, message= F, warning = F, fig.align='center'}
mapview(familias_ayudadas, zcol = "AYUDA_ENTREGADA2", legend = T, layer.name = c("Ayuda entregada a familias"))

```

```{r echo=FALSE, message= F, warning = F}
attach(familias_ayudadas)
table(COMUNA, AYUDA_ENTREGADA2)
```

```{r, include=FALSE, message= F, warning = F}
x=count(wti)
y <- as.integer(x)
h <-unique(data_1$COMUNA) %>% length %>% print()
```


## Como se aprecia en la tabla anterior, hemos ayudado a **`r y`** familias (en promedio de 4 integrantes) alrededor de **`r h`** comunas.


```{r include=FALSE, echo=F, message= F, warning = F}
familias <- familias_apoyadas %>%
  mutate(date = dmy(DATE))
class(familias_apoyadas$date)

(a <- familias %>% 
    group_by(date) %>% 
    summarise(n = n()) %>% 
    mutate(nfam = cumsum(n)) %>% 
    ggplot(aes(date, nfam)) +
    geom_line(colour ="#00CD66") +
    geom_point(colour = "#008B45") +
    xlab(NULL) +
    ylab("Número de familias \n") +
    labs(title = "Evolución de la ayuda por fecha",
         subtitle = paste0("Fecha actualización: ", Sys.Date()-1)) +
    #scale_x_date(date_breaks = "3 days") +
    scale_y_continuous(breaks = seq(0, 200, 20))+
    theme_minimal() +
    theme(legend.title = element_blank()))

```

____
```{r echo=FALSE, collapse=TRUE, message= F, warning = F}
ggplotly(a)
```

